id: nfcore_scrnaseq
description: nf-core/scrnaseq wrapper; requires genome and Cell Ranger index. Samplesheet generated by post_render hook.
params:
  genome:
    type: str
    required: true
    cli: "--genome"
    description: "iGenomes identifier (e.g. GRCh38, GRCm39)"
  agendo_id:
    type: int
    required: true
    cli: "--agendo-id"
    description: "Agendo request id to fetch metadata"
  cellranger_index:
    type: str
    required: true
    cli: "--cellranger_index"
    description: "Cell Ranger reference index path (matches genome)"
  aligner:
    type: str
    required: false
    default: "cellranger"
    cli: "--aligner"
    description: "Aligner to use (simpleaf, kallisto, star, cellranger, cellrangerarc, cellrangermulti)"
  protocol:
    type: str
    required: false
    default: "auto"
    cli: "--protocol"
    description: "Library protocol (e.g. 10XV2/10XV3/10XV4); 'auto' for Cell Ranger"
  skip_cellbender:
    type: bool
    required: false
    default: true
    cli: "--skip_cellbender"
    description: "Skip CellBender empty drops"
  expected_cells:
    type: int
    required: false
    description: "Expected cells per sample; used when generating samplesheet.csv if set"
  max_cpus:
    type: int
    required: false
    cli: "--max-cpus"
    description: "Maximum CPUs for nf-core/scrnaseq (default: 80% of host)"
  max_memory:
    type: str
    required: false
    cli: "--max-memory"
    description: "Maximum memory for nf-core/scrnaseq (default: 80% of host)"
render:
  into: "${ctx.project_dir}/${ctx.template.id}/"
  files:
    - run.sh.j2 -> run.sh
    - nextflow.config -> nextflow.config
run:
  entry: run.sh
hooks:
  pre_render:
    - hooks.agendo:fetch
    - hooks.genome_from_organism:set_from_organism
    - hooks.nfcore_rnaseq_resources_80pct:set_max_resources_80pct
  post_render:
    - hooks.nfcore_scrnaseq_samplesheet:main
publish:
  nfcore_multiqc:
    resolver: "resolvers.get_multiqc_report"
  nfcore_samplesheet:
    resolver: "resolvers.get_samplesheet"
tools:
  required: []
  optional: []

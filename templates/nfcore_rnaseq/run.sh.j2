#!/usr/bin/env bash
set -euo pipefail

{% if ctx.params.umi %}
# Using UMI arguments tuned for Takara Bio SMARTerÂ® Stranded Total RNA-Seq Kit v3.
{% endif %}
{% if ctx.params.ercc %}
# Update PATH_TO_ERCC below to the ERCC spike-in FASTA available on your system.
{% endif %}

echo "[info] $(date) nf-core/rnaseq profile=docker genome={{ ctx.params.genome }}"
nextflow -version || true
mkdir -p "results"

nextflow run nf-core/rnaseq \
  -r "3.21.0" \
  -profile "docker" \
  -c nextflow.config \
  --input "samplesheet.csv" \
  --outdir "results" \
{% if ctx.params.umi %}
  --with_umi \
  --umitools_extract_method "regex" \
  --umitools_bc_pattern2 "^(?P<umi_1>.{8})(?P<discard_1>.{6}).*" \
{% endif %}
{% if ctx.params.ercc %}
  --additional_fasta /data/genomes/ERCC/ \
{% endif %}
  --genome "{{ ctx.params.genome }}"

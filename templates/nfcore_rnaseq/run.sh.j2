#!/usr/bin/env bash
set -euo pipefail

# nf-core/rnaseq version (pinned via params)
NFCORE_VERSION="{{ ctx.params.nfcore_version }}"

# Runtime profile (docker|singularity|conda|custom)
PROFILE="{{ ctx.params.profile }}"

# Outputs
OUTDIR="{{ ctx.params.outdir }}"

# The samplesheet.csv is generated by the pre_run hook
# (hooks.nfcore_rnaseq_samplesheet_reverse:main) in this same folder.
SAMPLESHEET="samplesheet.csv"

CMD=( nextflow run nf-core/rnaseq \
      -r "${NFCORE_VERSION}" \
      -profile "${PROFILE}" \
      -c nextflow.config \
      --input "${SAMPLESHEET}" \
      --outdir "${OUTDIR}" )

# Support resuming a previous Nextflow run
{% if ctx.params.resume %}
CMD+=( -resume )
{% endif %}

# Optional extra args passthrough (space-separated string)
EXTRA_ARGS="{{ ctx.params.extra_args }}"
if [[ -n "$EXTRA_ARGS" ]]; then
  # shellcheck disable=SC2206
  EXTRA_ARR=($EXTRA_ARGS)
  CMD+=("${EXTRA_ARR[@]}")
fi

printf 'Running:'
printf ' %q' "${CMD[@]}"
echo
exec "${CMD[@]}"

